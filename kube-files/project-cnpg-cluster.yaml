apiVersion: postgresql.cnpg.io/v1
kind: Cluster
metadata:
  name: <project_ref>
  namespace: <project_namespace>
spec:
  imageCatalogRef:
    apiGroup: postgresql.cnpg.io
    kind: ClusterImageCatalog
    name: postgresql
    major: 18
  instances: 1
  managed:
    services:
      disabledDefaultServices: ["ro", "r"]
    roles:
      - name: app
        login: true
        superuser: true
      - name: anon
        ensure: present
        comment: PostgREST Anonymous Role
      - name: authenticated
        ensure: present
        comment: PostgREST Logged-in User Role
      - name: app_admin
        ensure: present
        comment: PostgREST App Admin Role
        bypassrls: true
      - name: authenticator
        ensure: present
        comment: PostgREST Authenticator
        login: true
        passwordSecret:
          name: baas-db-authenticator
        inRoles:
          - anon
          - authenticated
          - app_admin
  bootstrap:
    initdb:
      database: app
      owner: app
  storage:
    size: 1Gi
